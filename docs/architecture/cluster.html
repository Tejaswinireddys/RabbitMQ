<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive RabbitMQ 4.x Cluster Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .font-fira-code {
            font-family: 'Fira Code', monospace;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        @keyframes blink {
            50% { opacity: 0; }
        }
        .cursor-blink {
            animation: blink 1s step-end infinite;
        }
        /* Custom scrollbar for log view */
        .log-view::-webkit-scrollbar {
            width: 6px;
        }
        .log-view::-webkit-scrollbar-track {
            background: #1f2937; /* bg-gray-800 */
        }
        .log-view::-webkit-scrollbar-thumb {
            background: #4b5563; /* bg-gray-600 */
            border-radius: 3px;
        }
        .log-view::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* bg-gray-500 */
        }
        /* Styles for active/inactive tabs */
        .tab-btn {
            transition: all 0.2s ease-in-out;
        }
        .tab-btn.active {
            border-color: #4f46e5; /* indigo-600 */
            background-color: #4f46e5;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 p-4 sm:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-6">
            <div class="flex justify-center items-center gap-4">
                <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white">RabbitMQ 4.x Cluster Dashboard</h1>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="flex flex-wrap justify-center space-x-2 sm:space-x-4 mb-8">
            <button id="tab-overview" class="tab-btn active text-sm sm:text-base font-semibold px-4 py-2 rounded-lg border-2 border-transparent mb-2" onclick="showTab('overview')">Cluster Overview</button>
            <button id="tab-queues" class="tab-btn text-sm sm:text-base font-semibold px-4 py-2 rounded-lg border-2 border-transparent mb-2" onclick="showTab('queues')">Quorum Queue</button>
            <button id="tab-health" class="tab-btn text-sm sm:text-base font-semibold px-4 py-2 rounded-lg border-2 border-transparent mb-2" onclick="showTab('health')">Health & Diagnostics</button>
            <button id="tab-security" class="tab-btn text-sm sm:text-base font-semibold px-4 py-2 rounded-lg border-2 border-transparent mb-2" onclick="showTab('security')">Security</button>
            <button id="tab-queue-handling" class="tab-btn text-sm sm:text-base font-semibold px-4 py-2 rounded-lg border-2 border-transparent mb-2" onclick="showTab('queue-handling')">Queue Handling</button>
            <button id="tab-simulation" class="tab-btn text-sm sm:text-base font-semibold px-4 py-2 rounded-lg border-2 border-transparent mb-2" onclick="showTab('simulation')">Failure Simulation</button>
        </nav>

        <!-- Page Content -->
        <main>
            <!-- Page 1: Cluster Overview -->
            <div id="page-overview" class="fade-in">
                <div class="relative">
                    <svg class="absolute inset-0 w-full h-full" style="z-index: 0;"><line x1="25%" y1="50%" x2="50%" y2="50%" stroke="#4b5563" stroke-width="2" stroke-dasharray="5,5"/><line x1="75%" y1="50%" x2="50%" y2="50%" stroke="#4b5563" stroke-width="2" stroke-dasharray="5,5"/><line x1="25%" y1="50%" x2="75%" y2="50%" stroke="#4b5563" stroke-width="2" stroke-dasharray="5,5" transform="translate(0, 20)"/></svg>
                    <div class="relative grid grid-cols-1 lg:grid-cols-3 gap-8" style="z-index: 1;">
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border-t-4 border-green-500"><div class="flex justify-between items-center mb-4"><h3 class="text-xl font-bold text-gray-900 dark:text-white">rabbit@node1</h3><span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300">ONLINE</span></div><div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400 mb-4 border-b dark:border-gray-700 pb-4"><span class="font-semibold bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-300 px-2 py-1 rounded">LEADER</span><div class="flex items-center gap-2"><span>Erlang/OTP 26+</span><svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7V17L12 22L22 17V7L12 2Z" stroke="#818cf8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 7L12 12" stroke="#818cf8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 22V12" stroke="#818cf8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 7L12 12" stroke="#818cf8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M17 4.5L7 9.5" stroke="#818cf8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div></div><div class="text-xs text-gray-400 space-y-2 mb-4"><p><span class="font-semibold text-gray-300">Uptime:</span> 7d 4h 12m</p><p><span class="font-semibold text-gray-300">Apps:</span> rabbit, ra, os_mon, mnesia</p></div><div class="grid grid-cols-3 gap-4 text-center mb-4"><div><p class="text-xs text-gray-500">Memory</p><p class="font-semibold text-lg">450<span class="text-sm">MB</span></p></div><div><p class="text-xs text-gray-500">Disk Free</p><p class="font-semibold text-lg">2.1<span class="text-sm">GB</span></p></div><div><p class="text-xs text-gray-500">Sockets</p><p class="font-semibold text-lg">120</p></div></div><div class="bg-gray-900 rounded-lg p-4 h-48 overflow-y-auto log-view font-fira-code text-xs"><p><span class="text-cyan-400">22:40:15.123 [info]</span> <span class="text-gray-300">&lt;0.256.0&gt; Raft leader for 'visibility.qq' is rabbit@node1</span></p><p><span class="text-cyan-400">22:40:15.345 [info]</span> <span class="text-gray-300">&lt;0.312.0&gt; connection accepted</span></p><p><span class="text-cyan-400">22:40:16.801 [info]</span> <span class="text-gray-300">&lt;0.451.0&gt; 'visibility.qq': Follower rabbit@node2 has synchronized</span></p><p><span class="text-cyan-400">22:40:17.222 [info]</span> <span class="text-gray-300">&lt;0.452.0&gt; 'visibility.qq': Follower rabbit@node3 has synchronized</span></p><p><span class="text-yellow-400">22:40:18.500 [warning]</span> <span class="text-gray-300">&lt;0.199.0&gt; memory resource limit alarm set</span></p><p><span class="text-cyan-400">22:40:20.110 [info]</span> <span class="text-gray-300">&lt;0.501.0&gt; channel opened</span></p><p class="flex items-center"><span class="text-gray-400">></span><span class="bg-gray-200 w-2 h-3 inline-block ml-1 cursor-blink"></span></p></div></div>
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border-t-4 border-green-500"><div class="flex justify-between items-center mb-4"><h3 class="text-xl font-bold">rabbit@node2</h3><span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300">ONLINE</span></div><div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400 mb-4 border-b dark:border-gray-700 pb-4"><span class="font-semibold bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-300 px-2 py-1 rounded">FOLLOWER</span><div class="flex items-center gap-2"><span>Erlang/OTP 26+</span><svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7V17L12 22L22 17V7L12 2Z" stroke="#818cf8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 7L12 12" stroke="#818cf8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 22V12" stroke="#818cf8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 7L12 12" stroke="#818cf8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M17 4.5L7 9.5" stroke="#818cf8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div></div><div class="text-xs text-gray-400 space-y-2 mb-4"><p><span class="font-semibold text-gray-300">Uptime:</span> 7d 4h 10m</p><p><span class="font-semibold text-gray-300">Apps:</span> rabbit, ra, os_mon, mnesia</p></div><div class="grid grid-cols-3 gap-4 text-center mb-4"><div><p class="text-xs text-gray-500">Memory</p><p class="font-semibold text-lg">421<span class="text-sm">MB</span></p></div><div><p class="text-xs text-gray-500">Disk Free</p><p class="font-semibold text-lg">2.5<span class="text-sm">GB</span></p></div><div><p class="text-xs text-gray-500">Sockets</p><p class="font-semibold text-lg">98</p></div></div><div class="bg-gray-900 rounded-lg p-4 h-48 overflow-y-auto log-view font-fira-code text-xs"><p><span class="text-cyan-400">22:40:15.120 [info]</span> <span class="text-gray-300">&lt;0.250.0&gt; Starting Raft follower for 'visibility.qq'</span></p><p><span class="text-cyan-400">22:40:16.799 [info]</span> <span class="text-gray-300">&lt;0.451.0&gt; Successfully synchronized with leader rabbit@node1</span></p><p><span class="text-cyan-400">22:40:17.500 [info]</span> <span class="text-gray-300">&lt;0.315.0&gt; connection accepted</span></p><p><span class="text-cyan-400">22:40:21.030 [info]</span> <span class="text-gray-300">&lt;0.505.0&gt; channel opened</span></p><p class="flex items-center"><span class="text-gray-400">></span><span class="bg-gray-200 w-2 h-3 inline-block ml-1 cursor-blink"></span></p></div></div>
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border-t-4 border-green-500"><div class="flex justify-between items-center mb-4"><h3 class="text-xl font-bold">rabbit@node3</h3><span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300">ONLINE</span></div><div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400 mb-4 border-b dark:border-gray-700 pb-4"><span class="font-semibold bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-300 px-2 py-1 rounded">FOLLOWER</span><div class="flex items-center gap-2"><span>Erlang/OTP 26+</span><svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7V17L12 22L22 17V7L12 2Z" stroke="#818cf8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 7L12 12" stroke="#818cf8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 22V12" stroke="#818cf8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 7L12 12" stroke="#818cf8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M17 4.5L7 9.5" stroke="#818cf8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div></div><div class="text-xs text-gray-400 space-y-2 mb-4"><p><span class="font-semibold text-gray-300">Uptime:</span> 7d 4h 11m</p><p><span class="font-semibold text-gray-300">Apps:</span> rabbit, ra, os_mon, mnesia</p></div><div class="grid grid-cols-3 gap-4 text-center mb-4"><div><p class="text-xs text-gray-500">Memory</p><p class="font-semibold text-lg">415<span class="text-sm">MB</span></p></div><div><p class="text-xs text-gray-500">Disk Free</p><p class="font-semibold text-lg">2.6<span class="text-sm">GB</span></p></div><div><p class="text-xs text-gray-500">Sockets</p><p class="font-semibold text-lg">102</p></div></div><div class="bg-gray-900 rounded-lg p-4 h-48 overflow-y-auto log-view font-fira-code text-xs"><p><span class="text-cyan-400">22:40:15.121 [info]</span> <span class="text-gray-300">&lt;0.251.0&gt; Starting Raft follower for 'visibility.qq'</span></p><p><span class="text-cyan-400">22:40:17.220 [info]</span> <span class="text-gray-300">&lt;0.452.0&gt; Successfully synchronized with leader rabbit@node1</span></p><p><span class="text-cyan-400">22:40:19.834 [info]</span> <span class="text-gray-300">&lt;0.318.0&gt; connection accepted</span></p><p class="flex items-center"><span class="text-gray-400">></span><span class="bg-gray-200 w-2 h-3 inline-block ml-1 cursor-blink"></span></p></div></div>
                    </div>
                </div>
            </div>

            <!-- Page 2: Quorum Queue Deep Dive -->
            <div id="page-queues" class="fade-in hidden">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 sm:p-8"><h2 class="text-2xl font-bold mb-2">Quorum Queue: <span class="text-indigo-400 font-mono">visibility.qq</span></h2><p class="text-sm text-gray-500 dark:text-gray-400 mb-6">Status: <span class="text-green-400">Running</span></p><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-center mb-8"><div class="bg-gray-100 dark:bg-gray-700/50 p-4 rounded-lg"><p class="text-sm text-gray-500 dark:text-gray-400">Messages Ready</p><p class="text-3xl font-bold">1,240</p></div><div class="bg-gray-100 dark:bg-gray-700/50 p-4 rounded-lg"><p class="text-sm text-gray-500 dark:text-gray-400">Messages Unacked</p><p class="text-3xl font-bold">32</p></div><div class="bg-gray-100 dark:bg-gray-700/50 p-4 rounded-lg"><p class="text-sm text-gray-500 dark:text-gray-400">Incoming Rate</p><p class="text-3xl font-bold">150<span class="text-lg">/s</span></p></div><div class="bg-gray-100 dark:bg-gray-700/50 p-4 rounded-lg"><p class="text-sm text-gray-500 dark:text-gray-400">Deliver/Get Rate</p><p class="text-3xl font-bold">148<span class="text-lg">/s</span></p></div></div><h3 class="text-xl font-semibold mb-4">Raft Members</h3><div class="space-y-4"><div class="flex items-center justify-between bg-gray-100 dark:bg-gray-700/50 p-4 rounded-lg"><div class="font-semibold">rabbit@node1</div><div class="text-sm text-indigo-400">LEADER</div><div class="text-sm text-green-400">Synchronised</div></div><div class="flex items-center justify-between bg-gray-100 dark:bg-gray-700/50 p-4 rounded-lg"><div class="font-semibold">rabbit@node2</div><div class="text-sm text-gray-400">FOLLOWER</div><div class="text-sm text-green-400">Synchronised</div></div><div class="flex items-center justify-between bg-gray-100 dark:bg-gray-700/50 p-4 rounded-lg"><div class="font-semibold">rabbit@node3</div><div class="text-sm text-gray-400">FOLLOWER</div><div class="text-sm text-green-400">Synchronised</div></div></div></div>
            </div>

            <!-- Page 3: Health & Diagnostics -->
            <div id="page-health" class="fade-in hidden">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 sm:p-8"><div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6"><div><h2 class="text-2xl font-bold">Cluster Health & Diagnostics</h2><p class="text-gray-500 dark:text-gray-400">An overview of key cluster health metrics.</p></div><div class="mt-4 md:mt-0 flex items-center gap-3"><span id="health-status-badge" class="px-4 py-2 rounded-full text-sm font-semibold bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-300">Not Run</span><button id="run-diagnostics-btn" onclick="runDiagnostics()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">Run Diagnostics</button></div></div><div id="diagnostics-results" class="space-y-4"><p class="text-center text-gray-500 dark:text-gray-400 py-8">Click "Run Diagnostics" to check the cluster's health.</p></div><div id="recommendations" class="mt-8 border-t dark:border-gray-700 pt-6 hidden"><h3 class="text-xl font-semibold mb-4 text-yellow-500">Recommendations</h3><div id="recommendations-list" class="space-y-3 text-gray-600 dark:text-gray-300"></div></div></div>
            </div>
            
            <!-- Page 4: Security -->
            <div id="page-security" class="fade-in hidden">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 sm:p-8">
                    <div class="flex items-center gap-4 mb-6">
                        <svg class="h-8 w-8 text-blue-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                        <h2 class="text-2xl font-bold">Security Best Practices</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-gray-100 dark:bg-gray-700/50 p-5 rounded-lg">
                            <h3 class="font-semibold mb-2 text-lg">TLS/SSL Encryption</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Encrypt all client and inter-node communication to prevent eavesdropping. Ensure certificates are valid and properly configured.</p>
                            <div class="mt-3 text-xs font-mono"><span class="text-green-400">Status:</span> AMQPS listener on port 5671</div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700/50 p-5 rounded-lg">
                            <h3 class="font-semibold mb-2 text-lg">Access Control (Vhosts & Users)</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Use virtual hosts (vhosts) to isolate environments. Create specific users with the minimum required permissions (e.g., read, write, configure) for each application.</p>
                            <div class="mt-3 text-xs font-mono"><span class="text-green-400">Users:</span> 5 active | <span class="text-green-400">VHosts:</span> 3 configured</div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700/50 p-5 rounded-lg">
                            <h3 class="font-semibold mb-2 text-lg">Management UI Security</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Expose the management UI only on a private network or protect it with a firewall and HTTPS. Use strong, unique passwords for management users.</p>
                            <div class="mt-3 text-xs font-mono"><span class="text-yellow-400">Warning:</span> UI accessible on public IP</div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700/50 p-5 rounded-lg">
                            <h3 class="font-semibold mb-2 text-lg">Regular Audits</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Periodically review user permissions, firewall rules, and RabbitMQ logs to detect unauthorized access attempts or configuration drift.</p>
                            <div class="mt-3 text-xs font-mono"><span class="text-gray-500">Last Audit:</span> 45 days ago</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Page 5: Advanced Queue Handling -->
            <div id="page-queue-handling" class="fade-in hidden">
                 <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 sm:p-8">
                    <div class="flex items-center gap-4 mb-6">
                        <svg class="h-8 w-8 text-purple-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 18h.01"/><path d="M12 6h.01"/><path d="M18 12h.01"/><path d="M6 12h.01"/><path d="M12 2a10 10 0 1 0 10 10"/><path d="M12 8v4l2 2"/></svg>
                        <h2 class="text-2xl font-bold">Advanced Queue Handling</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="bg-gray-100 dark:bg-gray-700/50 p-5 rounded-lg">
                            <h3 class="font-semibold mb-2 text-lg">Dead Letter Exchanges (DLX)</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Configure a DLX to catch and re-route messages that are rejected or expire. This prevents message loss and allows for later inspection or reprocessing.</p>
                            <div class="mt-3 text-xs font-mono"><span class="text-green-400">Policy:</span> dlx-policy applied to 'visibility.qq'</div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700/50 p-5 rounded-lg">
                            <h3 class="font-semibold mb-2 text-lg">Message TTL (Time-To-Live)</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Set a per-message or per-queue TTL to automatically discard stale messages. This is useful for time-sensitive data that loses value quickly.</p>
                            <div class="mt-3 text-xs font-mono"><span class="text-gray-500">Queue TTL:</span> Not set</div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700/50 p-5 rounded-lg">
                            <h3 class="font-semibold mb-2 text-lg">Queue Policies</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Use policies to apply settings like DLX, TTL, or max-length to a group of queues at once, simplifying management and ensuring consistency.</p>
                             <div class="mt-3 text-xs font-mono"><span class="text-green-400">Active Policies:</span> 2</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page 6: Failure Simulation -->
            <div id="page-simulation" class="fade-in hidden">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 sm:p-8"><div class="text-center mb-6"><h2 class="text-2xl font-bold">Cluster Failure Simulation</h2><p class="text-gray-500 dark:text-gray-400">Simulate a leader node failure to observe the Raft consensus protocol in action.</p><div class="mt-4"><button id="fail-btn" onclick="simulateFailure()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">Simulate Failure on rabbit@node1</button><button id="reset-btn" onclick="resetSimulation()" class="hidden bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">Reset Simulation</button></div></div><div class="grid grid-cols-1 lg:grid-cols-3 gap-8"><div id="sim-node1" class="bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 border-t-4 border-green-500 transition-all duration-500"><div class="flex justify-between items-center mb-4"><h3 class="text-xl font-bold">rabbit@node1</h3><span id="sim-node1-status" class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300">ONLINE</span></div><div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400 mb-4 border-b dark:border-gray-700 pb-4"><span id="sim-node1-role" class="font-semibold bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-300 px-2 py-1 rounded">LEADER</span></div><div id="sim-node1-log" class="bg-gray-900 rounded-lg p-4 h-48 overflow-y-auto log-view font-fira-code text-xs"><p><span class="text-cyan-400">22:40:15 [info]</span> <span class="text-gray-300">Raft leader for 'visibility.qq' is self</span></p></div></div><div id="sim-node2" class="bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 border-t-4 border-green-500 transition-all duration-500"><div class="flex justify-between items-center mb-4"><h3 class="text-xl font-bold">rabbit@node2</h3><span id="sim-node2-status" class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300">ONLINE</span></div><div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400 mb-4 border-b dark:border-gray-700 pb-4"><span id="sim-node2-role" class="font-semibold bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-300 px-2 py-1 rounded">FOLLOWER</span></div><div id="sim-node2-log" class="bg-gray-900 rounded-lg p-4 h-48 overflow-y-auto log-view font-fira-code text-xs"><p><span class="text-cyan-400">22:40:16 [info]</span> <span class="text-gray-300">Synchronized with leader rabbit@node1</span></p></div></div><div id="sim-node3" class="bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 border-t-4 border-green-500 transition-all duration-500"><div class="flex justify-between items-center mb-4"><h3 class="text-xl font-bold">rabbit@node3</h3><span id="sim-node3-status" class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300">ONLINE</span></div><div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400 mb-4 border-b dark:border-gray-700 pb-4"><span id="sim-node3-role" class="font-semibold bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-300 px-2 py-1 rounded">FOLLOWER</span></div><div id="sim-node3-log" class="bg-gray-900 rounded-lg p-4 h-48 overflow-y-auto log-view font-fira-code text-xs"><p><span class="text-cyan-400">22:40:17 [info]</span> <span class="text-gray-300">Synchronized with leader rabbit@node1</span></p></div></div></div></div>
            </div>
        </main>
    </div>

    <script>
        const pages = ['overview', 'queues', 'health', 'security', 'queue-handling', 'simulation'];
        
        function showTab(tabName) {
            // Hide all pages
            pages.forEach(page => {
                const el = document.getElementById(`page-${page}`);
                if (el) el.classList.add('hidden');
            });
            // Deactivate all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show the selected page and activate its button
            const pageEl = document.getElementById(`page-${tabName}`);
            const tabEl = document.getElementById(`tab-${tabName}`);
            if (pageEl) pageEl.classList.remove('hidden');
            if (tabEl) tabEl.classList.add('active');
        }

        function appendLog(logEl, level, message) {
            const timestamp = new Date().toLocaleTimeString('en-GB');
            let colorClass = 'text-cyan-400';
            if (level === 'warning') colorClass = 'text-yellow-400';
            if (level === 'error') colorClass = 'text-red-500';

            const p = document.createElement('p');
            p.innerHTML = `<span class="${colorClass}">${timestamp} [${level}]</span> <span class="text-gray-300">${message}</span>`;
            logEl.appendChild(p);
            logEl.scrollTop = logEl.scrollHeight; // Auto-scroll to bottom
        }

        function simulateFailure() {
            document.getElementById('fail-btn').disabled = true;
            document.getElementById('fail-btn').classList.add('opacity-50');

            // 1. Node 1 fails
            const node1 = document.getElementById('sim-node1');
            const node1Status = document.getElementById('sim-node1-status');
            const node1Log = document.getElementById('sim-node1-log');
            
            node1.classList.remove('border-green-500');
            node1.classList.add('border-red-500', 'opacity-60');
            node1Status.textContent = 'OFFLINE';
            node1Status.className = 'bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded-full dark:bg-red-900 dark:text-red-300';
            appendLog(node1Log, 'error', 'Node shutting down unexpectedly...');

            // 2. Other nodes detect failure
            const node2Log = document.getElementById('sim-node2-log');
            const node3Log = document.getElementById('sim-node3-log');
            setTimeout(() => {
                appendLog(node2Log, 'warning', 'Connection to leader rabbit@node1 lost');
                appendLog(node3Log, 'warning', 'Connection to leader rabbit@node1 lost');
            }, 1000);

            // 3. Leader election starts
            setTimeout(() => {
                appendLog(node2Log, 'info', 'Starting new leader election (term 2)');
                appendLog(node3Log, 'info', 'Starting new leader election (term 2)');
                appendLog(node2Log, 'info', 'Voted for self');
                appendLog(node3Log, 'info', 'Received vote request from rabbit@node2, granting vote');
            }, 2500);
            
            // 4. New leader is elected
            setTimeout(() => {
                const node2Role = document.getElementById('sim-node2-role');
                
                appendLog(node2Log, 'info', 'Received majority of votes. Becoming new leader.');
                node2Role.textContent = 'LEADER';
                node2Role.className = 'font-semibold bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-300 px-2 py-1 rounded';
                
                appendLog(node3Log, 'info', 'New leader is rabbit@node2. Following.');
                
                document.getElementById('reset-btn').classList.remove('hidden');
            }, 4000);
        }

        function resetSimulation() {
            document.getElementById('fail-btn').disabled = false;
            document.getElementById('fail-btn').classList.remove('opacity-50');
            document.getElementById('reset-btn').classList.add('hidden');

            // Reset Node 1
            const node1 = document.getElementById('sim-node1');
            document.getElementById('sim-node1-status').textContent = 'ONLINE';
            document.getElementById('sim-node1-status').className = 'bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300';
            document.getElementById('sim-node1-role').textContent = 'LEADER';
            document.getElementById('sim-node1-role').className = 'font-semibold bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-300 px-2 py-1 rounded';
            node1.className = 'bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 border-t-4 border-green-500 transition-all duration-500';
            document.getElementById('sim-node1-log').innerHTML = `<p><span class="text-cyan-400">${new Date().toLocaleTimeString('en-GB')} [info]</span> <span class="text-gray-300">Raft leader for 'visibility.qq' is self</span></p>`;

            // Reset Node 2
            document.getElementById('sim-node2-role').textContent = 'FOLLOWER';
            document.getElementById('sim-node2-role').className = 'font-semibold bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-300 px-2 py-1 rounded';
            document.getElementById('sim-node2-log').innerHTML = `<p><span class="text-cyan-400">${new Date().toLocaleTimeString('en-GB')} [info]</span> <span class="text-gray-300">Synchronized with leader rabbit@node1</span></p>`;
            
            // Reset Node 3
            document.getElementById('sim-node3-role').textContent = 'FOLLOWER';
            document.getElementById('sim-node3-role').className = 'font-semibold bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-300 px-2 py-1 rounded';
            document.getElementById('sim-node3-log').innerHTML = `<p><span class="text-cyan-400">${new Date().toLocaleTimeString('en-GB')} [info]</span> <span class="text-gray-300">Synchronized with leader rabbit@node1</span></p>`;
        }

        // --- Health Diagnostics Logic ---
        function runDiagnostics() {
            const btn = document.getElementById('run-diagnostics-btn');
            const resultsEl = document.getElementById('diagnostics-results');
            const recommendationsEl = document.getElementById('recommendations');
            const recommendationsListEl = document.getElementById('recommendations-list');
            const healthBadge = document.getElementById('health-status-badge');

            btn.disabled = true;
            btn.textContent = 'Running...';
            resultsEl.innerHTML = '<div class="flex justify-center items-center py-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"></div></div>';
            recommendationsEl.classList.add('hidden');
            recommendationsListEl.innerHTML = '';

            // Simulate an API call
            setTimeout(() => {
                const checks = [
                    { name: 'Memory Usage', status: 'pass', details: 'All nodes below 80% watermark.', recommendation: null },
                    { name: 'Disk Space', status: 'warning', details: 'Node rabbit@node1 is below 15% free disk space.', recommendation: 'Consider archiving old data or increasing disk size for rabbit@node1.' },
                    { name: 'Network Partitions', status: 'pass', details: 'All nodes are reachable.', recommendation: null },
                    { name: 'Socket Descriptors', status: 'pass', details: 'All nodes below 90% of limit.', recommendation: null },
                    { name: 'Inter-node Communication', status: 'pass', details: 'Latency is within acceptable limits.', recommendation: null }
                ];

                let hasWarning = false;
                resultsEl.innerHTML = ''; // Clear spinner

                checks.forEach(check => {
                    const isPass = check.status === 'pass';
                    if (!isPass) hasWarning = true;

                    const icon = isPass 
                        ? `<svg class="h-6 w-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`
                        : `<svg class="h-6 w-6 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>`;
                    
                    const resultHTML = `
                        <div class="flex items-center justify-between bg-gray-100 dark:bg-gray-700/50 p-4 rounded-lg">
                            <div class="flex items-center gap-4">
                                ${icon}
                                <div>
                                    <p class="font-semibold">${check.name}</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">${check.details}</p>
                                </div>
                            </div>
                            <span class="font-semibold text-sm ${isPass ? 'text-green-500' : 'text-yellow-500'}">${isPass ? 'PASS' : 'WARNING'}</span>
                        </div>
                    `;
                    resultsEl.innerHTML += resultHTML;

                    if (check.recommendation) {
                        recommendationsListEl.innerHTML += `<p>&bull; ${check.recommendation}</p>`;
                    }
                });

                if (hasWarning) {
                    healthBadge.textContent = 'Warnings Found';
                    healthBadge.className = 'px-4 py-2 rounded-full text-sm font-semibold bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300';
                    recommendationsEl.classList.remove('hidden');
                } else {
                    healthBadge.textContent = 'Healthy';
                    healthBadge.className = 'px-4 py-2 rounded-full text-sm font-semibold bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300';
                }

                btn.disabled = false;
                btn.textContent = 'Run Diagnostics';
            }, 2000);
        }
    </script>
</body>
</html>
